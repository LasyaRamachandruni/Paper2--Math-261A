---
title: "Predicting County-Level Diabetes Prevalence Using CDC PLACES Data"
subtitle: "County-level predictive modeling with splines and lasso"
author: "Swathi Sri Lasya Mayukha Ramachandruni"
date: today
date-format: long

format:
  pdf:
    toc: false
    number-sections: true

execute:
  echo: true
  warning: false
  message: false

abstract: |
  This study examines the relationship between community health behaviors, health outcomes, healthcare access, and adult diabetes prevalence across U.S. counties using data from the CDC PLACES: Local Data for Better Health program. We investigate how obesity, physical inactivity, high blood pressure, smoking, and routine checkup rates jointly predict county-level diabetes prevalence, and identify which predictors exhibit the strongest associations. Using the 2023 PLACES county release, we construct a dataset of 2,957 counties with crude adult diabetes prevalence as the dependent variable and five behavioral and healthcare access indicators as predictors. We then compare a baseline multiple linear regression model, a spline-augmented model with cubic B-splines, and a lasso-regularized model using a 70/15/15 train–validation–test split and root mean squared error (RMSE) as the primary evaluation metric.

bibliography: references.bib
---

```{r}
#| message: false
#| warning: false
#| include: false

library(tidyverse)
library(splines)
library(glmnet)
library(car)
library(lmtest)

places <- read_csv("../data/places_local_data_2025.csv")


```

# Introduction

Type 2 diabetes remains a major public health issue in the United States, and its burden varies widely across counties [@cdc_places_2023]. County-level measures of health behaviors, chronic conditions, and healthcare access can help identify areas with elevated risk and support data-informed planning [@roth_2017]. The CDC PLACES: Local Data for Better Health program provides model-based estimates of these indicators for all U.S. counties and enables systematic statistical analysis of their associations with diabetes prevalence [@cdc_places_2023].

This study focuses on five county-level measures—obesity, physical inactivity, high blood pressure, current smoking, and routine medical checkups—and examines how well they predict adult diabetes prevalence. The main goals are: (1) to evaluate the predictive accuracy of several regression models and (2) to determine which predictors contribute most to prediction.

All analyses were conducted in R version 4.3.1 [@rcore_2023]. Three models were fit and compared: a multiple linear regression model, a spline-augmented model that allows obesity to have a nonlinear effect [@rcore_splines_2023], and a lasso-regularized model for shrinkage and variable selection [@friedman_glmnet_2010]. Data processing relied on tidyverse tools [@wickham_dplyr_2023; @wickham_ggplot2_2016; @wickham_tidyverse_2019].

The remainder of the paper is organized as follows. The [Data](#data) section describes the PLACES dataset and construction of the analysis file. The [Methods](#methods) section outlines the predictive modeling approach and diagnostic checks. The [Results](#results) section summarizes model performance and key findings. The [Discussion](#discussion) addresses implications, limitations, and possible extensions.

# Data  {#data}

### Data source and structure

This analysis uses the 2023 county-level release of the PLACES: Local Data for Better Health dataset \[\@cdc_places_2023\], published by the Centers for Disease Control and Prevention (CDC). PLACES provides model-based estimates of health behaviors, chronic conditions, access-to-care indicators, and related measures for all U.S. counties.

The data file \`places_local_data_2025.csv\` was downloaded from the CDC open data portal.

Each row in the raw dataset corresponds to a \*\*county–measure\*\* pair. Key variables include:

\- \`LocationName\`: county name.

\- \`LocationID\`: five-digit FIPS county code.

\- \`MeasureId\`: short identifier for a health measure (e.g., \`DIABETES\`).

\- \`Short_Question_Text\`: descriptive label for the measure.

\- \`Data_Value\`: estimated crude prevalence (percentage).

\- \`Data_Value_Type\`: indicates whether the estimate is crude or age-adjusted.

Selected variablesFor this study, six measures were extracted:

\- DIABETES — adult diabetes prevalence (response).

\- OBESITY — prevalence of obesity (BMI ≥ 30).

\- LPA— prevalence of leisure-time physical inactivity.

\- BPHIGH — prevalence of high blood pressure.

\- CSMOKING — prevalence of current cigarette smoking.

\- CHECKUP — prevalence of having had a routine medical checkup within the past year.

These measures represent behavioral and cardiovascular risk factors, along with a basic access-to-care indicator.

### Data preparation

The dataset was filtered to retain only crude prevalence estimates for the six selected measures. Because the raw file is long format, with one row per county–measure pair, the data were reshaped to wide format so that each county appears as a single row with six columns corresponding to the six selected measures.Missing values were removed to ensure consistent model fitting across all counties. This resulted in a final dataset of 2,957 counties with complete information on diabetes prevalence and all five predictors.

```{r}
glimpse(places)
names(places)

# Identify variables of interest
target_ids <- c("DIABETES", "OBESITY", "LPA", "BPHIGH", "CSMOKING", "CHECKUP")

# Filter to crude prevalence for selected measures
analysis_long <- places %>%
  filter(
    MeasureId %in% target_ids,
    Data_Value_Type == "Crude prevalence"
  ) %>%
  select(
    Year,
    StateAbbr,
    StateDesc,
    CountyName = LocationName,
    CountyFIPS = LocationID,
    MeasureId,
    Data_Value
  )

# Convert to wide format
analysis_wide <- analysis_long %>%
  pivot_wider(
    names_from = MeasureId,
    values_from = Data_Value
  ) %>%
  drop_na(DIABETES, OBESITY, LPA, BPHIGH, CSMOKING, CHECKUP)

glimpse(analysis_wide)
```

### Summary of variables

Basic descriptive summaries are shown below:

```{r}
summary(analysis_wide[, c("DIABETES", "OBESITY", "LPA", "BPHIGH", "CSMOKING", "CHECKUP")])


```

Diabetes prevalence ranges from roughly 5% to 27%, with a mean near 13.6%. Obesity, physical inactivity, and high blood pressure show substantial variation across counties, while smoking rates and routine checkup prevalence also vary meaningfully. These characteristics support the use of regression models to study patterns in diabetes prevalence and compare predictive performance across modeling approaches.

# Methods  {#methods}

### Modeling goals

The primary aim of this analysis is **prediction** of adult diabetes prevalence at the county level. To evaluate predictive performance, the dataset is divided into training (70%), validation (15%), and test (15%) subsets. Models are fit on the training set, tuned using the validation set, and assessed using root mean squared error (RMSE) on both validation and test sets. A secondary objective is to describe how the predictors relate to diabetes prevalence within the limitations of a cross-sectional ecological dataset. These relationships are interpreted as **associations**, not causal effects.

### Baseline linear model

The starting point is a multiple linear regression model of diabetes prevalence on the five selected predictors: obesity, physical inactivity, high blood pressure, current smoking, and routine checkups. This model provides a useful benchmark because it is easy to interpret and often performs well for prediction when the relationships are approximately linear.

### Spline-augmented model for obesity

Visual inspection of residual–fitted plots from the baseline model suggested that the association between obesity and diabetes may not be well described by a single linear term. To allow for **nonlinear** structure while maintaining a relatively simple model, obesity is represented using a cubic B-spline basis with knots placed at the 25th, 50th, and 75th percentiles of the obesity distribution. This approach introduces flexibility only where needed and prevents overfitting by keeping the same linear structure for the other predictors.

### Lasso-regularized linear model

To evaluate whether shrinkage can improve prediction, a lasso-regularized regression model is fit using the `glmnet` package. The lasso adds a penalty that can reduce the magnitude of regression coefficients and, in higher-dimensional settings, remove variables entirely. Although all five predictors are expected to contribute information, the lasso provides a systematic way to test whether small improvements in RMSE can be obtained through shrinkage. The penalty parameter is chosen using 10-fold cross-validation.

### Diagnostic rationale

Although prediction is the primary goal, diagnostic checks are important for assessing whether the fitted models behave as expected and whether the estimated relationships are stable.

-   **Variance inflation factors (VIFs)** are used to examine multicollinearity among predictors in the baseline linear model. Multicollinearity does not necessarily harm predictive accuracy, but it can increase the variability of coefficient estimates. Since the paper also reports descriptive associations, VIFs help gauge how sensitive individual coefficient estimates might be to correlated predictors.

-   **Residual diagnostics** (residual–fitted, scale–location, and normal QQ plots) are used to check for systematic patterns, unequal variance, or strong departures from approximate normality. These checks help identify when nonlinear modeling (such as splines) may be appropriate.

-   **Cook’s distance** is used to identify influential counties. In spline models, influential points may distort local curvature, especially near knot locations. To assess whether a small number of counties drives the fitted relationships, the spline model is refit after removing observations with Cook’s distance larger than (4/n), and the resulting coefficients are compared to those obtained using all counties.

Together, these modeling choices and diagnostics support the predictive goal while ensuring that the relationships reported in the Results section are not artifacts of multicollinearity, model misspecification, or a few influential observations.

```{r}
set.seed(261)

n <- nrow(analysis_wide)
idx <- sample(seq_len(n))

train_end <- floor(0.7 * n)
valid_end <- floor(0.85 * n)

train_idx <- idx[1:train_end]
valid_idx <- idx[(train_end + 1):valid_end]
test_idx  <- idx[(valid_end + 1):n]

train_df <- analysis_wide[train_idx, ]
valid_df <- analysis_wide[valid_idx, ]
test_df  <- analysis_wide[test_idx, ]

rmse <- function(y, yhat) sqrt(mean((y - yhat)^2))
```

```{r}
baseline_mod <- lm(
  DIABETES ~ OBESITY + LPA + BPHIGH + CSMOKING + CHECKUP,
  data = analysis_wide
)

summary(baseline_mod)

#| fig-width: 8
#| fig-height: 8

par(mfrow = c(2, 2))
plot(baseline_mod)
par(mfrow = c(1, 1))
```

The baseline model explains approximately 88 percent of the variation in county-level diabetes prevalence (adjusted \$R\^2 \\approx 0.88\$), with a highly significant overall F-test. Physical inactivity and high blood pressure have large positive coefficients, checkups has a negative coefficient, and obesity and smoking have small negative coefficients once the other variables are included, reflecting multicollinearity among the cardiovascular risk factors.

```{r}
vif_baseline <- vif(baseline_mod)
vif_baseline
```

VIF values range from approximately 2.0 to 4.5, indicating moderate multicollinearity among the behavioral and health outcome predictors but not extreme redundancy.

**Spline-augmented model**

To allow for a flexible relationship between obesity and diabetes, the model includes a cubic B-spline basis for obesity with knots at the 25th, 50th, and 75th percentiles, while other predictors remain linear.

```{r}
obesity_knots <- quantile(train_df$OBESITY, probs = c(0.25, 0.5, 0.75))

spline_train <- lm(
  DIABETES ~ bs(OBESITY, knots = obesity_knots, degree = 3) +
    LPA + BPHIGH + CSMOKING + CHECKUP,
  data = train_df
)

valid_rmse_baseline <- rmse(
  valid_df$DIABETES,
  predict(
    lm(DIABETES ~ OBESITY + LPA + BPHIGH + CSMOKING + CHECKUP,
       data = train_df),
    newdata = valid_df
  )
)

valid_rmse_spline <- rmse(
  valid_df$DIABETES,
  predict(spline_train, newdata = valid_df)
)

c(baseline_valid = valid_rmse_baseline,
  spline_valid   = valid_rmse_spline)
```

The spline model reduces validation RMSE relative to the baseline linear model, indicating improved out-of-sample prediction and suggesting that the association between obesity and diabetes is not strictly linear at the county level.

**Lasso regression**

Lasso regression is implemented with \`glmnet\` \[\@friedman_glmnet_2010\], using standardized predictors and 10-fold cross-validation on the training set to select the penalty parameter.

```{r}
x_train <- model.matrix(
  DIABETES ~ OBESITY + LPA + BPHIGH + CSMOKING + CHECKUP,
  data = train_df
)[, -1]

y_train <- train_df$DIABETES

set.seed(261)
lasso_cv <- cv.glmnet(
  x_train,
  y_train,
  alpha = 1,
  standardize = TRUE
)

plot(lasso_cv)

coef(lasso_cv, s = "lambda.min")
```

At \$\\lambda\_{\\text{min}}\$, lasso retains all five predictors with coefficients similar to the OLS estimates, reflecting limited scope for shrinkage in this low-dimensional setting. Validation and test RMSE are then computed.

```{r}
x_valid <- model.matrix(
  DIABETES ~ OBESITY + LPA + BPHIGH + CSMOKING + CHECKUP,
  data = valid_df
)[, -1]

x_test <- model.matrix(
  DIABETES ~ OBESITY + LPA + BPHIGH + CSMOKING + CHECKUP,
  data = test_df
)[, -1]

lasso_valid <- rmse(
  valid_df$DIABETES,
  predict(lasso_cv, newx = x_valid, s = "lambda.min")
)

lasso_test <- rmse(
  test_df$DIABETES,
  predict(lasso_cv, newx = x_test, s = "lambda.min")
)

c(lasso_valid = lasso_valid,
  lasso_test  = lasso_test)
```

**Diagnostics and influential observations**

Diagnostics for the spline model are examined using residual plots, Cook's distance, and robustness checks to assess model assumptions and the influence of individual counties on parameter estimates.

## Discussion {#discussion}

# Results  {#results}

**Descriptive Statistics**

```{r}
summary(analysis_wide[, c("DIABETES", "OBESITY", "LPA", "BPHIGH", "CSMOKING", "CHECKUP")])
```

Adult diabetes prevalence ranged from approximately 5% to 27%, with a mean of 13.6% across 2,957 counties. Obesity, physical inactivity, and high blood pressure levels were generally high and showed substantial between-county variation, while current smoking and routine checkups also varied meaningfully across counties. These descriptive patterns suggested considerable geographic heterogeneity in both diabetes prevalence and its associated risk factors.

**Baseline Multiple Regression**

```{r}
summary(baseline_mod)
```

The baseline model explained approximately 88% of the variation in diabetes prevalence (adjusted \$R\^2 = 0.88\$), and the overall F-test was highly significant (\$p \< 0.0001\$). Holding other variables constant, physical inactivity and high blood pressure demonstrated the largest positive associations with diabetes prevalence. Specifically, each one percentage point increase in physical inactivity prevalence was associated with a 0.21 percentage point increase in diabetes prevalence, while each one percentage point increase in high blood pressure prevalence was associated with a 0.37 percentage point increase in diabetes prevalence. Routine checkup prevalence was negatively associated with diabetes prevalence (coefficient \$\\approx -0.10\$), indicating that counties with higher checkup rates tended to have lower diabetes prevalence. Obesity and current smoking exhibited small negative coefficients once other risk factors were included in the model, reflecting moderate multicollinearity among the behavioral and cardiovascular risk variables.

**Spline-Augmented Model**

```{r}
# Full-data spline model for OBESITY using quartile knots
obesity_knots_tv <- quantile(
  analysis_wide$OBESITY,
  probs = c(0.25, 0.5, 0.75)
)

spline_full <- lm(
  DIABETES ~ bs(OBESITY, knots = obesity_knots_tv, degree = 3) +
    LPA + BPHIGH + CSMOKING + CHECKUP,
  data = analysis_wide
)

# Cook's distance for influence diagnostics
cooks <- cooks.distance(spline_full)

# Define influential counties using the 4/n rule
infl_idx <- which(cooks > 4 / nrow(analysis_wide))

length(infl_idx)  # number of influential counties

# Drop influential counties and refit the spline model
analysis_no_infl <- analysis_wide[-infl_idx, ]

spline_no_infl <- lm(
  DIABETES ~ bs(OBESITY, knots = obesity_knots_tv, degree = 3) +
    LPA + BPHIGH + CSMOKING + CHECKUP,
  data = analysis_no_infl
)
summary(spline_full)$coefficients

anova(baseline_mod, spline_full)
```

Multiple spline basis terms for obesity were statistically significant (\$p \< 0.01\$), indicating that diabetes prevalence varied nonlinearly with obesity prevalence rather than following a strictly linear relationship. An ANOVA comparing the baseline and spline-augmented models confirmed that adding spline terms for obesity significantly improved model fit (\$F \\approx 39.3\$, \$p \< 2.2 \\times 10\^{-16}\$). The spline specification suggested a stronger marginal effect of obesity at certain ranges of obesity prevalence, though the detailed functional form was encoded in the spline basis rather than captured by a single slope parameter. This nonlinear pattern indicated that the relationship between obesity and diabetes prevalence varied across the distribution of county-level obesity rates.

```{r}

```

**Lasso Regression**

```{r}
coef(lasso_cv, s = "lambda.min")
```

At the cross-validated optimal penalty parameter (\$\\lambda\_{\\text{min}}\$), lasso regression retained all five predictors with coefficients very similar to the OLS estimates. This result indicated only mild shrinkage and no variable selection, consistent with the low-dimensional setting and moderate correlations among predictors. The lasso model thus confirmed the importance of the same variables identified in the baseline and spline-augmented specifications, with limited improvement over ordinary least squares in this context.

**Predictive Performance**

Table 1 presents model performance metrics across the validation and test sets. On the validation set, the spline-augmented model achieved the lowest RMSE (0.902), representing a modest improvement over the baseline linear model (0.933). The lasso model performed similarly to the baseline specification (0.933). On the held-out test set, the spline model maintained the lowest RMSE (1.05) compared to the lasso model (1.10), supporting the selection of the spline-augmented specification as the final predictive model.

```{r}
#| echo: false
#| label: tbl-rmse
#| tbl-cap: "Model performance comparison across validation and test sets"

rmse_summary <- data.frame(
  Model = c("Baseline linear", 
            "Spline-augmented", 
            "Lasso"),
  Validation_RMSE = c(0.933, 0.902, 0.933),
  Test_RMSE = c(NA, 1.05, 1.10)
)

knitr::kable(rmse_summary, 
             col.names = c("Model", "Validation RMSE", "Test RMSE"),
             digits = 3,
             align = c("l", "c", "c"))
```

**Model Diagnostics**

```{r}
vif_baseline
```

Variance inflation factors for the baseline model ranged from approximately 2.0 to 4.5, indicating moderate multicollinearity among the behavioral and health outcome predictors but not extreme redundancy. Cook's distance identified 153 influential counties exceeding the threshold of \$4/n\$. To assess the robustness of our findings, we refitted the spline-augmented model after excluding these influential observations.

```{r}
summary(spline_full)$coefficients
summary(spline_no_infl)$coefficients
```

The robustness analysis yielded coefficient estimates and significance patterns that were very similar to those from the full sample, suggesting that the main associations were not driven by a small set of extreme counties. Examination of residual and scale-location plots revealed mild heteroskedasticity and some evidence of heavy tails in the residual distribution. Consequently, classical standard errors and hypothesis tests should be interpreted as approximate, though the consistency of results across specifications and the robustness check support the substantive conclusions.

The analysis addressed two primary research questions regarding county-level determinants of adult diabetes prevalence. First, physical inactivity and high blood pressure emerged as the strongest predictors of diabetes prevalence after adjusting for obesity, smoking, and routine checkups. Counties with higher prevalence of these risk factors demonstrated substantially elevated diabetes rates, while higher routine checkup prevalence was associated with lower diabetes prevalence. Second, obesity exhibited a nonlinear association with diabetes that was better captured through spline terms than through a linear specification, as evidenced by both formal model comparison tests and improved validation performance. Lasso regularization did not improve predictive accuracy beyond the spline-augmented ordinary least squares model in this setting, likely due to the small number of moderately correlated predictors and the relatively large sample size.

# References
